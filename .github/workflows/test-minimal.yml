name: Test Minimal Build

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  test-build:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install buildozer
      run: |
        pip install buildozer==1.5.0
    
    - name: Test buildozer init
      run: |
        buildozer init || echo "Buildozer init completed"
    
    - name: Show buildozer version
      run: |
        buildozer --version
    
    - name: Check buildozer.spec
      run: |
        echo "=== Buildozer.spec content ==="
        cat buildozer.spec
        echo "=== End buildozer.spec ==="
    
    - name: Test buildozer android debug (with timeout)
      run: |
        timeout 25m buildozer android debug || echo "Build timed out or failed, but that's expected for testing"
    
    - name: List any output files
      run: |
        echo "=== Checking for output files ==="
        ls -la bin/ || echo "No bin directory"
        find . -name "*.apk" -type f || echo "No APK files found"
        echo "=== Build completed (success or failure) ==="
